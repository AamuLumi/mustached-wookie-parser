%{
    #include <stdbool.h>
    
    bool codeExpanderInsertedOnLine = false;
    bool noBracketsCondition = false;
    bool onNoBracketsCondition = false;
%}

%%
("else"|"if").*; {codeExpanderInsertedOnLine = true; REJECT;}

.*{     {if (codeExpanderInsertedOnLine) 
            fprintf(yyout, "<img class=\"code-expander\" src=\"img/collapse.png\">");
         codeExpanderInsertedOnLine = true;
         REJECT;}
    
("else"|"if").*\n {if (codeExpanderInsertedOnLine){ 
            fprintf(yyout, "<img class=\"code-expander\" src=\"img/collapse.png\">");
            noBracketsCondition = true;
            }   
         codeExpanderInsertedOnLine = true;
         REJECT;} 
         


\n      {fprintf(yyout, "<br>");
         if (onNoBracketsConditions){
             onNoBracketsConditions = false;
             fprintf(yyout, "</div>");
         }
         if (noBracketsCondition){
             noBracketsCondition = false;
             onNoBracketsConditions = true;
             fprintf(yyout, "<div class=\"bloc\">");
         }
         codeExpanderInsertedOnLine = false;
         }